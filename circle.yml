## Customize the test machine
machine:
  pre:
      - git config --global user.email "circleci@joyent.zone"
      - git config --global user.name "circlebot"
      - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
      - sudo apt-key adv --keyserver pgp.mit.edu --recv D101F7899D41F3C3
      - echo "deb http://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
      - sudo apt-get update && sudo apt-get install yarn

  timezone:
    Europe/London

  services:
      - docker
  node:
    version: 6.9.1

dependencies:
  cache_directories:
      - "/opt/circleci/python/2.7.11/lib/python2.7/site-packages"
  pre:
      - sudo curl -L https://github.com/docker/compose/releases/download/1.8.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
      - sudo chmod +x /usr/local/bin/docker-compose
      - docker-compose -v
      - yarn global add triton
      - echo '{"url":"https://eu-ams-1.api.joyent.com","account":"'$SDC_ACCOUNT'","keyId":"c3:30:35:9b:85:48:73:44:31:cc:4b:2e:6a:00:16:e2","name":"eu-ams-1","curr":true}' | triton profile create -f -
      - mkdir -p ${CIRCLE_TEST_REPORTS}/tap-xunit/
  override:
      - make && make install

test:
  override:
      -  make -j2 lint-ci test-ci

deployment:
  production: # just a label; label names are completely up to you
    branch: master
    commands:
      - ./bin/deploy

## Custom notifications
# notify:
#   webhooks:
#     # A list of hashes representing hooks. Only the url field is supported.
#     - url: https://someurl.com/hooks/circle
